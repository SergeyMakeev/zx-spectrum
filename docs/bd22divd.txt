»з газеты Body #22, ћинск, 29.12.2000

--------------------------[  Coding  ]--------------------------
(c) Brom^Ellipse                                  500:17/2@zxnet

ѕривет  всем,  это  оп€ть  € и мои чудо процедуры на ассемблере.
—егодн€  €  представл€ю вашему вниманию очередную арифметическую
процедуру  делени€ 16-битного числа на 8-битное, т.е. деление HL
на  B.  ѕроцедурка довольно шустра€, дл€ самых умных € проставил
количество  тактов  при  выполнении  каждой  команды, если будет
желание  можете  подсчитать,  хот€  дл€  каждой комбинации врем€
выполнени€  будет  разным.     сожалению у мен€ в справочники не
оказалось  команды  сдвига битов SLI E, но по моим подсчетам она
выполн€етс€ за 8 тактов.
“ак  же  любители  оптимизации  могут  сразу же заметить стоки в
которых  сто€т  звездочки  (дл€  не пон€тливых "*"), если убрать
данные строки, то выходной результат будет находитьс€ не в HL, а
в  DE,  убрав  данные  строки  вы так же ускорите процедуру на 4
такта и уменьшите ее в объеме на 2 байта :)

;¬ходные данные:    ¬ыходные данные:
; HL - делимое      HL - результат
; B  - делитель

DIV_HL_B
        XOR   A       ; 4
        LD    DE,1    ; 10
DIV1    SLA   L       ; 8
        RL    H       ; 8
        RLA           ; 4
        CP    B       ; 4
        JR    C,ZR    ; 12/7
        SUB   B       ; 4
        SLI   E       ;
        RL    D       ; 8
        JR    NC,DIV1 ; 12/7
        EX    DE,HL   ; 4 *
        RET           ; 10
ZR      SLA   E       ; 8
        RL    D       ; 8
        JR    NC,DIV1 ; 12/7
        EX    DE,HL   ; 4 *
        RET           ; 10